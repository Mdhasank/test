pipeline {
    agent any

    stages {
        stage('Copy /text file to EC2') {
            steps {
                withCredentials([
                    sshUserPrivateKey(
                        credentialsId: 'ec2_ssh',
                        keyFileVariable: 'SSH_KEY',
                        usernameVariable: 'SSH_USER'
                    )
                ]) {
                    sh '''
                        echo "‚úÖ Checking if /text file exists on Jenkins VM..."
                        LOCAL_FILE="/text"

                        if [ ! -f "$LOCAL_FILE" ]; then
                            echo "‚ùå ERROR: File /text does not exist on Jenkins VM."
                            exit 1
                        fi

                        echo "üì§ Copying /text file to EC2 at /text..."
                        scp -i $SSH_KEY -o StrictHostKeyChecking=no $LOCAL_FILE $SSH_USER@13.233.247.189:/tmp/text

                        echo "üîÑ Moving file to root folder on EC2..."
                        ssh -i $SSH_KEY -o StrictHostKeyChecking=no $SSH_USER@13.233.247.189 '
                            sudo mv /tmp/text /text
                            sudo chown root:root /text
                            echo "‚úÖ File copied to /text on EC2!"
                        '
                    '''
                }
            }
        }
    }
}
